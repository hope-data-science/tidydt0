<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>One-to-one interface for data.table '[' method — query_if • tidydt</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="One-to-one interface for data.table '[' method — query_if" />
<meta property="og:description" content="Quote from data.table:
query(data, j,  by) # + extra arguments
            |   |
            |    -------&amp;gt; grouped by what?
             -------&amp;gt; what to do?
or,
query_if(data, i,  j,  by) # + extra arguments
               |   |   |
               |   |    -------&amp;gt; grouped by what?
               |    -------&amp;gt; what to do?
                ---&amp;gt; on which rows?
If you don't need 'i' argument, use 'query'. In this case you can
avoid printing leading comma inside brackets to denote empty 'i'." />
<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidydt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Introduction.html">Using data.table the tidy way</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/hope-data-science/tidydt">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>One-to-one interface for data.table '[' method</h1>
    <small class="dont-index">Source: <a href='https://github.com/hope-data-science/tidydt/blob/master/R/query.R'><code>R/query.R</code></a></small>
    <div class="hidden name"><code>query_if.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Quote from <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>:</p><pre>
query(data, j,  by) # + extra arguments
            |   |
            |    -------&gt; grouped by what?
             -------&gt; what to do?
</pre><p>or,</p><pre>
query_if(data, i,  j,  by) # + extra arguments
               |   |   |
               |   |    -------&gt; grouped by what?
               |    -------&gt; what to do?
                ---&gt; on which rows?
</pre><p>If you don't need '<code>i</code>' argument, use '<code>query</code>'. In this case you can
avoid printing leading comma inside brackets to denote empty '<code>i</code>'.</p>
    </div>

    <pre class="usage"><span class='fu'>query_if</span>(
  <span class='no'>data</span>,
  <span class='no'>i</span>,
  <span class='no'>j</span>,
  <span class='no'>by</span>,
  <span class='no'>keyby</span>,
  <span class='kw'>with</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>nomatch</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"datatable.nomatch"</span>),
  <span class='kw'>mult</span> <span class='kw'>=</span> <span class='st'>"all"</span>,
  <span class='kw'>roll</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>rollends</span> <span class='kw'>=</span> <span class='kw'>if</span> (<span class='no'>roll</span> <span class='kw'>==</span> <span class='st'>"nearest"</span>) <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>TRUE</span>, <span class='fl'>TRUE</span>) <span class='kw'>else</span> <span class='kw'>if</span> (<span class='no'>roll</span> <span class='kw'>&gt;=</span> <span class='fl'>0</span>) <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>FALSE</span>, <span class='fl'>TRUE</span>)
    <span class='kw'>else</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>TRUE</span>, <span class='fl'>FALSE</span>),
  <span class='kw'>which</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='no'>.SDcols</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"datatable.verbose"</span>),
  <span class='kw'>allow.cartesian</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"datatable.allow.cartesian"</span>),
  <span class='kw'>drop</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>on</span> <span class='kw'>=</span> <span class='kw'>NULL</span>
)

<span class='fu'>query</span>(
  <span class='no'>data</span>,
  <span class='no'>j</span>,
  <span class='no'>by</span>,
  <span class='no'>keyby</span>,
  <span class='kw'>with</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>nomatch</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"datatable.nomatch"</span>),
  <span class='kw'>mult</span> <span class='kw'>=</span> <span class='st'>"all"</span>,
  <span class='kw'>roll</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>rollends</span> <span class='kw'>=</span> <span class='kw'>if</span> (<span class='no'>roll</span> <span class='kw'>==</span> <span class='st'>"nearest"</span>) <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>TRUE</span>, <span class='fl'>TRUE</span>) <span class='kw'>else</span> <span class='kw'>if</span> (<span class='no'>roll</span> <span class='kw'>&gt;=</span> <span class='fl'>0</span>) <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>FALSE</span>, <span class='fl'>TRUE</span>)
    <span class='kw'>else</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>TRUE</span>, <span class='fl'>FALSE</span>),
  <span class='kw'>which</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='no'>.SDcols</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"datatable.verbose"</span>),
  <span class='kw'>allow.cartesian</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"datatable.allow.cartesian"</span>),
  <span class='kw'>drop</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>on</span> <span class='kw'>=</span> <span class='kw'>NULL</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>data.table/data.frame data.frame will be automatically converted
to data.table.</p></td>
    </tr>
    <tr>
      <th>i</th>
      <td><p>Integer, logical or character vector, single column numeric matrix,
expression of column names, list, data.frame or data.table. integer and
logical vectors work the same way they do in [.data.frame except logical
NAs are treated as FALSE. expression is evaluated within the frame of the
data.table (i.e. it sees column names as if they are variables) and can
evaluate to any of the other types. For details see
<a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></p></td>
    </tr>
    <tr>
      <th>j</th>
      <td><p>When with=TRUE (default), j is evaluated within the frame of the
data.table; i.e., it sees column names as if they are variables. This
allows to not just select columns in j, but also compute on them e.g., x[,
a] and x[, sum(a)] returns x$a and sum(x$a) as a vector respectively. x[,
.(a, b)] and x[, .(sa=sum(a), sb=sum(b))] returns a two column data.table
each, the first simply selecting columns a, b and the second computing
their sums. For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>unquoted name of grouping variable of list of unquoted names of
grouping variables. For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></p></td>
    </tr>
    <tr>
      <th>keyby</th>
      <td><p>Same as by, but with an additional <code><a href='https://Rdatatable.gitlab.io/data.table/reference/setkey.html'>setkey()</a></code> run on the by
columns of the result, for convenience. It is common practice to use
'keyby=' routinely when you wish the result to be sorted. For details see
<a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></p></td>
    </tr>
    <tr>
      <th>with</th>
      <td><p>logical. For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>nomatch</th>
      <td><p>Same as nomatch in match. For details see
<a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>mult</th>
      <td><p>For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>roll</th>
      <td><p>For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>rollends</th>
      <td><p>For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>which</th>
      <td><p>For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>.SDcols</th>
      <td><p>Specifies the columns of x to be included in the special
symbol .SD which stands for Subset of data.table. May be character column
names or numeric positions. For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical. For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>allow.cartesian</th>
      <td><p>For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>drop</th>
      <td><p>For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    <tr>
      <th>on</th>
      <td><p>For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>It depends. For details see <a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># examples from data.table</span>
<span class='no'>dat</span> <span class='kw'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span>(<span class='kw'>x</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"b"</span>,<span class='st'>"a"</span>,<span class='st'>"c"</span>),<span class='kw'>each</span><span class='kw'>=</span><span class='fl'>3</span>), <span class='kw'>y</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>3</span>,<span class='fl'>6</span>), <span class='kw'>v</span><span class='kw'>=</span><span class='fl'>1</span>:<span class='fl'>9</span>)
<span class='no'>dat</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 1 1
#&gt; 2: b 3 2
#&gt; 3: b 6 3
#&gt; 4: a 1 4
#&gt; 5: a 3 5
#&gt; 6: a 6 6
#&gt; 7: c 1 7
#&gt; 8: c 3 8
#&gt; 9: c 6 9</div><div class='input'><span class='co'># basic row subset operations</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fl'>2</span>)                        <span class='co'># 2nd row</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 3 2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fl'>3</span>:<span class='fl'>2</span>)                        <span class='co'># 3rd and 2nd row</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 6 3
#&gt; 2: b 3 2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span>(<span class='no'>x</span>))                   <span class='co'># no need for order(dat$x)</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: a 1 4
#&gt; 2: a 3 5
#&gt; 3: a 6 6
#&gt; 4: b 1 1
#&gt; 5: b 3 2
#&gt; 6: b 6 3
#&gt; 7: c 1 7
#&gt; 8: c 3 8
#&gt; 9: c 6 9</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>y</span><span class='kw'>&gt;</span><span class='fl'>2</span>)                        <span class='co'># all rows where dat$y &gt; 2</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 3 2
#&gt; 2: b 6 3
#&gt; 3: a 3 5
#&gt; 4: a 6 6
#&gt; 5: c 3 8
#&gt; 6: c 6 9</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>y</span><span class='kw'>&gt;</span><span class='fl'>2</span> <span class='kw'>&amp;</span> <span class='no'>v</span><span class='kw'>&gt;</span><span class='fl'>5</span>)                  <span class='co'># compound logical expressions</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: a 6 6
#&gt; 2: c 3 8
#&gt; 3: c 6 9</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, !<span class='fl'>2</span>:<span class='fl'>4</span>)                       <span class='co'># all rows other than 2:4</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 1 1
#&gt; 2: a 3 5
#&gt; 3: a 6 6
#&gt; 4: c 1 7
#&gt; 5: c 3 8
#&gt; 6: c 6 9</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, -(<span class='fl'>2</span>:<span class='fl'>4</span>))                     <span class='co'># same</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 1 1
#&gt; 2: a 3 5
#&gt; 3: a 6 6
#&gt; 4: c 1 7
#&gt; 5: c 3 8
#&gt; 6: c 6 9</div><div class='input'>
<span class='co'># select|compute columns data.table way</span>
<span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>v</span>)                        <span class='co'># v column (as vector)</span></div><div class='output co'>#&gt; [1] 1 2 3 4 5 6 7 8 9</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>v</span>))                  <span class='co'># v column (as data.table)</span></div><div class='output co'>#&gt;    v
#&gt; 1: 1
#&gt; 2: 2
#&gt; 3: 3
#&gt; 4: 4
#&gt; 5: 5
#&gt; 6: 6
#&gt; 7: 7
#&gt; 8: 8
#&gt; 9: 9</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>))                   <span class='co'># sum of column v, returned as vector</span></div><div class='output co'>#&gt; [1] 45</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>)))             <span class='co'># same, but return data.table (column autonamed V1)</span></div><div class='output co'>#&gt;    V1
#&gt; 1: 45</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>v</span>, <span class='no'>v</span>*<span class='fl'>2</span>))             <span class='co'># return two column data.table, v and v*2</span></div><div class='output co'>#&gt;    v V2
#&gt; 1: 1  2
#&gt; 2: 2  4
#&gt; 3: 3  6
#&gt; 4: 4  8
#&gt; 5: 5 10
#&gt; 6: 6 12
#&gt; 7: 7 14
#&gt; 8: 8 16
#&gt; 9: 9 18</div><div class='input'>
<span class='co'># subset rows and select|compute data.table way</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fl'>2</span>:<span class='fl'>3</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>))                <span class='co'># sum(v) over rows 2 and 3, return vector</span></div><div class='output co'>#&gt; [1] 5</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fl'>2</span>:<span class='fl'>3</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>)))             <span class='co'># same, but return data.table with column V1</span></div><div class='output co'>#&gt;    V1
#&gt; 1:  5</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fl'>2</span>:<span class='fl'>3</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>sv</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>)))          <span class='co'># same, but return data.table with column sv</span></div><div class='output co'>#&gt;    sv
#&gt; 1:  5</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fl'>2</span>:<span class='fl'>5</span>, <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span>(<span class='no'>v</span>, <span class='st'>"\n"</span>))          <span class='co'># just for j's side effect</span></div><div class='output co'>#&gt; 2 3 4 5 </div><div class='output co'>#&gt; NULL</div><div class='input'>
<span class='co'># select columns the data.frame way</span>
<span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fl'>2</span>, <span class='kw'>with</span><span class='kw'>=</span><span class='fl'>FALSE</span>)            <span class='co'># 2nd column, returns a data.table always</span></div><div class='output co'>#&gt;    y
#&gt; 1: 1
#&gt; 2: 3
#&gt; 3: 6
#&gt; 4: 1
#&gt; 5: 3
#&gt; 6: 6
#&gt; 7: 1
#&gt; 8: 3
#&gt; 9: 6</div><div class='input'><span class='no'>colNum</span> <span class='kw'>=</span> <span class='fl'>2</span>
<span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>colNum</span>, <span class='kw'>with</span><span class='kw'>=</span><span class='fl'>FALSE</span>)       <span class='co'># same, equivalent to DT[, .SD, .SDcols=colNum]</span></div><div class='output co'>#&gt;    y
#&gt; 1: 1
#&gt; 2: 3
#&gt; 3: 6
#&gt; 4: 1
#&gt; 5: 3
#&gt; 6: 6
#&gt; 7: 1
#&gt; 8: 3
#&gt; 9: 6</div><div class='input'>
<span class='co'># grouping operations - j and by</span>
<span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)             <span class='co'># ad hoc by, order of groups preserved in result</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: b  6
#&gt; 2: a 15
#&gt; 3: c 24</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>keyby</span><span class='kw'>=</span><span class='no'>x</span>)          <span class='co'># same, but order the result on by cols</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: a 15
#&gt; 2: b  6
#&gt; 3: c 24</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'>query_if</span>(<span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span>(<span class='no'>x</span>))               <span class='co'># same but by chaining expressions together</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: a 15
#&gt; 2: b  6
#&gt; 3: c 24</div><div class='input'>
<span class='co'># fast ad hoc row subsets (subsets as joins)</span>
<span class='co'># same as x == "a" but uses binary search (fast)</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='st'>"a"</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)</div><div class='output co'>#&gt;    x y v
#&gt; 1: a 1 4
#&gt; 2: a 3 5
#&gt; 3: a 6 6</div><div class='input'><span class='co'># same, for convenience, no need to quote every column</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='st'>"a"</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>x</span>))</div><div class='output co'>#&gt;    x y v
#&gt; 1: a 1 4
#&gt; 2: a 3 5
#&gt; 3: a 6 6</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fu'>.</span>(<span class='st'>"a"</span>), <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)                          <span class='co'># same</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: a 1 4
#&gt; 2: a 3 5
#&gt; 3: a 6 6</div><div class='input'><span class='co'># same, single "==" internally optimised to use binary search (fast)</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>x</span><span class='kw'>==</span><span class='st'>"a"</span>)</div><div class='output co'>#&gt;    x y v
#&gt; 1: a 1 4
#&gt; 2: a 3 5
#&gt; 3: a 6 6</div><div class='input'><span class='co'># not yet optimized, currently vector scan subset</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>x</span><span class='kw'>!=</span><span class='st'>"b"</span> <span class='kw'>|</span> <span class='no'>y</span><span class='kw'>!=</span><span class='fl'>3</span>)</div><div class='output co'>#&gt;    x y v
#&gt; 1: b 1 1
#&gt; 2: b 6 3
#&gt; 3: a 1 4
#&gt; 4: a 3 5
#&gt; 5: a 6 6
#&gt; 6: c 1 7
#&gt; 7: c 3 8
#&gt; 8: c 6 9</div><div class='input'><span class='co'># join on columns x,y of 'dat'; uses binary search (fast)</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fu'>.</span>(<span class='st'>"b"</span>, <span class='fl'>3</span>), <span class='kw'>on</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"x"</span>, <span class='st'>"y"</span>))</div><div class='output co'>#&gt;    x y v
#&gt; 1: b 3 2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fu'>.</span>(<span class='st'>"b"</span>, <span class='fl'>3</span>), <span class='kw'>on</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>x</span>, <span class='no'>y</span>))                <span class='co'># same, but using on=list()</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 3 2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fu'>.</span>(<span class='st'>"b"</span>, <span class='fl'>1</span>:<span class='fl'>2</span>), <span class='kw'>on</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"x"</span>, <span class='st'>"y"</span>))             <span class='co'># no match returns NA</span></div><div class='output co'>#&gt;    x y  v
#&gt; 1: b 1  1
#&gt; 2: b 2 NA</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fu'>.</span>(<span class='st'>"b"</span>, <span class='fl'>1</span>:<span class='fl'>2</span>), <span class='kw'>on</span><span class='kw'>=</span><span class='fu'>.</span>(<span class='no'>x</span>, <span class='no'>y</span>), <span class='kw'>nomatch</span><span class='kw'>=</span><span class='fl'>0</span>)      <span class='co'># no match row is not returned</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 1 1</div><div class='input'><span class='co'># locf, nomatch row gets rolled by previous row</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fu'>.</span>(<span class='st'>"b"</span>, <span class='fl'>1</span>:<span class='fl'>2</span>), <span class='kw'>on</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"x"</span>, <span class='st'>"y"</span>), <span class='kw'>roll</span><span class='kw'>=</span><span class='fl'>Inf</span>)</div><div class='output co'>#&gt;    x y v
#&gt; 1: b 1 1
#&gt; 2: b 2 1</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fu'>.</span>(<span class='st'>"b"</span>, <span class='fl'>1</span>:<span class='fl'>2</span>), <span class='kw'>on</span><span class='kw'>=</span><span class='fu'>.</span>(<span class='no'>x</span>, <span class='no'>y</span>), <span class='kw'>roll</span><span class='kw'>=</span>-<span class='fl'>Inf</span>)      <span class='co'># nocb, nomatch row gets rolled by next row</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 1 1
#&gt; 2: b 2 2</div><div class='input'><span class='co'># on rows where dat$x=="b", calculate sum(v*y)</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='st'>"b"</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>*<span class='no'>y</span>), <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)</div><div class='output co'>#&gt; [1] 25</div><div class='input'>
<span class='co'># all together now</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>x</span><span class='kw'>!=</span><span class='st'>"a"</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)                    <span class='co'># get sum(v) by "x" for each i != "a"</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: b  6
#&gt; 2: c 24</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, !<span class='st'>"a"</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>.EACHI</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)         <span class='co'># same, but using subsets-as-joins</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: b  6
#&gt; 2: c 24</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"b"</span>,<span class='st'>"c"</span>), <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>.EACHI</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)   <span class='co'># same</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: b  6
#&gt; 2: c 24</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"b"</span>,<span class='st'>"c"</span>), <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>.EACHI</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='fu'>.</span>(<span class='no'>x</span>))  <span class='co'># same, using on=.()</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: b  6
#&gt; 2: c 24</div><div class='input'>
<span class='co'># joins as subsets</span>
<span class='no'>X</span> <span class='kw'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span>(<span class='kw'>x</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"c"</span>,<span class='st'>"b"</span>), <span class='kw'>v</span><span class='kw'>=</span><span class='fl'>8</span>:<span class='fl'>7</span>, <span class='kw'>foo</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>4</span>,<span class='fl'>2</span>))
<span class='no'>X</span></div><div class='output co'>#&gt;    x v foo
#&gt; 1: c 8   4
#&gt; 2: b 7   2</div><div class='input'>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)                         <span class='co'># right join</span></div><div class='output co'>#&gt;    x y v i.v foo
#&gt; 1: c 1 7   8   4
#&gt; 2: c 3 8   8   4
#&gt; 3: c 6 9   8   4
#&gt; 4: b 1 1   7   2
#&gt; 5: b 3 2   7   2
#&gt; 6: b 6 3   7   2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>X</span>, <span class='no'>dat</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)                         <span class='co'># left join</span></div><div class='output co'>#&gt;    x  v foo y i.v
#&gt; 1: b  7   2 1   1
#&gt; 2: b  7   2 3   2
#&gt; 3: b  7   2 6   3
#&gt; 4: a NA  NA 1   4
#&gt; 5: a NA  NA 3   5
#&gt; 6: a NA  NA 6   6
#&gt; 7: c  8   4 1   7
#&gt; 8: c  8   4 3   8
#&gt; 9: c  8   4 6   9</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>, <span class='kw'>nomatch</span><span class='kw'>=</span><span class='fl'>0</span>)              <span class='co'># inner join</span></div><div class='output co'>#&gt;    x y v i.v foo
#&gt; 1: c 1 7   8   4
#&gt; 2: c 3 8   8   4
#&gt; 3: c 6 9   8   4
#&gt; 4: b 1 1   7   2
#&gt; 5: b 3 2   7   2
#&gt; 6: b 6 3   7   2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, !<span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)                        <span class='co'># not join</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: a 1 4
#&gt; 2: a 3 5
#&gt; 3: a 6 6</div><div class='input'><span class='co'># join using column "y" of 'dat' with column "v" of X</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>y</span><span class='kw'>=</span><span class='st'>"v"</span>))</div><div class='output co'>#&gt;       x y  v i.x foo
#&gt; 1: &lt;NA&gt; 8 NA   c   4
#&gt; 2: &lt;NA&gt; 7 NA   b   2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>,<span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"y==v"</span>)                       <span class='co'># same as above (v1.9.8+)</span></div><div class='output co'>#&gt;       x y  v i.x foo
#&gt; 1: &lt;NA&gt; 8 NA   c   4
#&gt; 2: &lt;NA&gt; 7 NA   b   2</div><div class='input'>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span> <span class='kw'>=</span> <span class='fu'>.</span>(<span class='no'>y</span><span class='kw'>&lt;=</span><span class='no'>foo</span>))                 <span class='co'># NEW non-equi join (v1.9.8+)</span></div><div class='output co'>#&gt;    x y v i.x i.v
#&gt; 1: b 4 1   c   8
#&gt; 2: b 4 2   c   8
#&gt; 3: a 4 4   c   8
#&gt; 4: a 4 5   c   8
#&gt; 5: c 4 7   c   8
#&gt; 6: c 4 8   c   8
#&gt; 7: b 2 1   b   7
#&gt; 8: a 2 4   b   7
#&gt; 9: c 2 7   b   7</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"y&lt;=foo"</span>)                    <span class='co'># same as above</span></div><div class='output co'>#&gt;    x y v i.x i.v
#&gt; 1: b 4 1   c   8
#&gt; 2: b 4 2   c   8
#&gt; 3: a 4 4   c   8
#&gt; 4: a 4 5   c   8
#&gt; 5: c 4 7   c   8
#&gt; 6: c 4 8   c   8
#&gt; 7: b 2 1   b   7
#&gt; 8: a 2 4   b   7
#&gt; 9: c 2 7   b   7</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"y&lt;=foo"</span>))                 <span class='co'># same as above</span></div><div class='output co'>#&gt;    x y v i.x i.v
#&gt; 1: b 4 1   c   8
#&gt; 2: b 4 2   c   8
#&gt; 3: a 4 4   c   8
#&gt; 4: a 4 5   c   8
#&gt; 5: c 4 7   c   8
#&gt; 6: c 4 8   c   8
#&gt; 7: b 2 1   b   7
#&gt; 8: a 2 4   b   7
#&gt; 9: c 2 7   b   7</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='fu'>.</span>(<span class='no'>y</span><span class='kw'>&gt;=</span><span class='no'>foo</span>))                   <span class='co'># NEW non-equi join (v1.9.8+)</span></div><div class='output co'>#&gt;    x y v i.x i.v
#&gt; 1: b 4 3   c   8
#&gt; 2: a 4 6   c   8
#&gt; 3: c 4 9   c   8
#&gt; 4: b 2 2   b   7
#&gt; 5: b 2 3   b   7
#&gt; 6: a 2 5   b   7
#&gt; 7: a 2 6   b   7
#&gt; 8: c 2 8   b   7
#&gt; 9: c 2 9   b   7</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='fu'>.</span>(<span class='no'>x</span>, <span class='no'>y</span><span class='kw'>&lt;=</span><span class='no'>foo</span>))                <span class='co'># NEW non-equi join (v1.9.8+)</span></div><div class='output co'>#&gt;    x y v i.v
#&gt; 1: c 4 7   8
#&gt; 2: c 4 8   8
#&gt; 3: b 2 1   7</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='fu'>.</span>(<span class='no'>x</span>,<span class='no'>y</span>,<span class='no'>x.y</span>,<span class='no'>v</span>), <span class='kw'>on</span><span class='kw'>=</span><span class='fu'>.</span>(<span class='no'>x</span>, <span class='no'>y</span><span class='kw'>&gt;=</span><span class='no'>foo</span>))  <span class='co'># Select x's join columns as well</span></div><div class='output co'>#&gt;    x y x.y v
#&gt; 1: c 4   6 9
#&gt; 2: b 2   3 2
#&gt; 3: b 2   6 3</div><div class='input'>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>, <span class='kw'>mult</span><span class='kw'>=</span><span class='st'>"first"</span>)           <span class='co'># first row of each group</span></div><div class='output co'>#&gt;    x y v i.v foo
#&gt; 1: c 1 7   8   4
#&gt; 2: b 1 1   7   2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>, <span class='kw'>mult</span><span class='kw'>=</span><span class='st'>"last"</span>)            <span class='co'># last row of each group</span></div><div class='output co'>#&gt;    x y v i.v foo
#&gt; 1: c 6 9   8   4
#&gt; 2: b 6 3   7   2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>.EACHI</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)      <span class='co'># join and eval j for each row in i</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: c 24
#&gt; 2: b  6</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>)*<span class='no'>foo</span>, <span class='kw'>by</span><span class='kw'>=</span><span class='no'>.EACHI</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)  <span class='co'># join inherited scope</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: c 96
#&gt; 2: b 12</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>)*<span class='no'>i.v</span>, <span class='kw'>by</span><span class='kw'>=</span><span class='no'>.EACHI</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>)  <span class='co'># 'i,v' refers to X's v column</span></div><div class='output co'>#&gt;    x  V1
#&gt; 1: c 192
#&gt; 2: b  42</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>X</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='fu'>.</span>(<span class='no'>x</span>, <span class='no'>v</span><span class='kw'>&gt;=</span><span class='no'>v</span>), <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>y</span>)*<span class='no'>foo</span>, <span class='kw'>by</span><span class='kw'>=</span><span class='no'>.EACHI</span>) <span class='co'># NEW non-equi join with by=.EACHI (v1.9.8+)</span></div><div class='output co'>#&gt;    x v V1
#&gt; 1: c 8 36
#&gt; 2: b 7 NA</div><div class='input'>

<span class='co'># more on special symbols, see also ?"special-symbols"</span>
<span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>.N</span>)                           <span class='co'># last row</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: c 6 9</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>.N</span>)                              <span class='co'># total number of rows in DT</span></div><div class='output co'>#&gt; [1] 9</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>.N</span>, <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)                        <span class='co'># number of rows in each group</span></div><div class='output co'>#&gt;    x N
#&gt; 1: b 3
#&gt; 2: a 3
#&gt; 3: c 3</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>.SD</span>, <span class='kw'>.SDcols</span><span class='kw'>=</span><span class='no'>x</span>:<span class='no'>y</span>)                <span class='co'># select columns 'x' and 'y'</span></div><div class='output co'>#&gt;    x y
#&gt; 1: b 1
#&gt; 2: b 3
#&gt; 3: b 6
#&gt; 4: a 1
#&gt; 5: a 3
#&gt; 6: a 6
#&gt; 7: c 1
#&gt; 8: c 3
#&gt; 9: c 6</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>.SD</span>[<span class='fl'>1</span>])                          <span class='co'># first row of all columns</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 1 1</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>.SD</span>[<span class='fl'>1</span>], <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)                    <span class='co'># first row of 'y' and 'v' for each group in 'x'</span></div><div class='output co'>#&gt;    x y v
#&gt; 1: b 1 1
#&gt; 2: a 1 4
#&gt; 3: c 1 7</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>.N</span>, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>sum</span>)), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)   <span class='co'># get rows *and* sum columns 'v' and 'y' by group</span></div><div class='output co'>#&gt;    x N  y  v
#&gt; 1: b 3 10  6
#&gt; 2: a 3 10 15
#&gt; 3: c 3 10 24</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>.I</span>[<span class='fl'>1</span>], <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)                     <span class='co'># row number in DT corresponding to each group</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: b  1
#&gt; 2: a  4
#&gt; 3: c  7</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>grp</span> <span class='kw'>:=</span> <span class='no'>.GRP</span>, <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>) <span class='kw'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>()    <span class='co'># add a group counter column</span></div><div class='output co'>#&gt;    x y v grp
#&gt; 1: b 1 1   1
#&gt; 2: b 3 2   1
#&gt; 3: b 6 3   1
#&gt; 4: a 1 4   2
#&gt; 5: a 3 5   2
#&gt; 6: a 6 6   2</div><div class='input'><span class='fu'>query</span>(<span class='no'>X</span>, <span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='no'>.BY</span>, <span class='no'>y</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)               <span class='co'># join within each group</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: c  1
#&gt; 2: c  3
#&gt; 3: c  6
#&gt; 4: b  1
#&gt; 5: b  3
#&gt; 6: b  6</div><div class='input'>
<span class='co'># add/update/delete by reference (see ?assign)</span>
<span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>z</span><span class='kw'>:=</span><span class='fl'>42L</span>) <span class='kw'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>()         <span class='co'># add new column by reference</span></div><div class='output co'>#&gt;    x y v grp  z
#&gt; 1: b 1 1   1 42
#&gt; 2: b 3 2   1 42
#&gt; 3: b 6 3   1 42
#&gt; 4: a 1 4   2 42
#&gt; 5: a 3 5   2 42
#&gt; 6: a 6 6   2 42</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>z</span><span class='kw'>:=</span><span class='kw'>NULL</span>) <span class='kw'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>()        <span class='co'># remove column by reference</span></div><div class='output co'>#&gt;    x y v grp
#&gt; 1: b 1 1   1
#&gt; 2: b 3 2   1
#&gt; 3: b 6 3   1
#&gt; 4: a 1 4   2
#&gt; 5: a 3 5   2
#&gt; 6: a 6 6   2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='st'>"a"</span>, <span class='no'>v</span><span class='kw'>:=</span><span class='fl'>42L</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>) <span class='kw'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>()  <span class='co'># subassign to existing v column by reference</span></div><div class='output co'>#&gt;    x y  v grp
#&gt; 1: b 1  1   1
#&gt; 2: b 3  2   1
#&gt; 3: b 6  3   1
#&gt; 4: a 1 42   2
#&gt; 5: a 3 42   2
#&gt; 6: a 6 42   2</div><div class='input'><span class='fu'>query_if</span>(<span class='no'>dat</span>, <span class='st'>"b"</span>, <span class='no'>v2</span><span class='kw'>:=</span><span class='fl'>84L</span>, <span class='kw'>on</span><span class='kw'>=</span><span class='st'>"x"</span>) <span class='kw'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>() <span class='co'># subassign to new column by reference (NA padded)</span></div><div class='output co'>#&gt;    x y  v grp v2
#&gt; 1: b 1  1   1 84
#&gt; 2: b 3  2   1 84
#&gt; 3: b 6  3   1 84
#&gt; 4: a 1 42   2 NA
#&gt; 5: a 3 42   2 NA
#&gt; 6: a 6 42   2 NA</div><div class='input'>
<span class='co'># NB: postfix [] is shortcut to print()</span>
<span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>m</span><span class='kw'>:=</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)[]              <span class='co'># add new column by reference by group</span></div><div class='output co'>#&gt;    x y  v grp v2  m
#&gt; 1: b 1  1   1 84  2
#&gt; 2: b 3  2   1 84  2
#&gt; 3: b 6  3   1 84  2
#&gt; 4: a 1 42   2 NA 42
#&gt; 5: a 3 42   2 NA 42
#&gt; 6: a 6 42   2 NA 42
#&gt; 7: c 1  7   3 NA  8
#&gt; 8: c 3  8   3 NA  8
#&gt; 9: c 6  9   3 NA  8</div><div class='input'>
<span class='co'># advanced usage</span>
<span class='no'>dat</span> <span class='kw'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span>(<span class='kw'>x</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"b"</span>,<span class='st'>"a"</span>,<span class='st'>"c"</span>),<span class='kw'>each</span><span class='kw'>=</span><span class='fl'>3</span>),
                 <span class='kw'>v</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>2</span>,<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>2</span>),
                 <span class='kw'>y</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>3</span>,<span class='fl'>6</span>),
                 <span class='kw'>a</span><span class='kw'>=</span><span class='fl'>1</span>:<span class='fl'>9</span>,
                 <span class='kw'>b</span><span class='kw'>=</span><span class='fl'>9</span>:<span class='fl'>1</span>)
<span class='no'>dat</span></div><div class='output co'>#&gt;    x v y a b
#&gt; 1: b 1 1 1 9
#&gt; 2: b 1 3 2 8
#&gt; 3: b 1 6 3 7
#&gt; 4: a 2 1 4 6
#&gt; 5: a 2 3 5 5
#&gt; 6: a 1 6 6 4
#&gt; 7: c 1 1 7 3
#&gt; 8: c 2 3 8 2
#&gt; 9: c 2 6 9 1</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='fu'>.</span>(<span class='no'>y</span><span class='kw'>%%</span><span class='fl'>2</span>))              <span class='co'># expressions in by</span></div><div class='output co'>#&gt;    y V1
#&gt; 1: 1  9
#&gt; 2: 0  4</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='fu'>.</span>(<span class='kw'>bool</span> <span class='kw'>=</span> <span class='no'>y</span><span class='kw'>%%</span><span class='fl'>2</span>))       <span class='co'># same, using a named list to change by column name</span></div><div class='output co'>#&gt;    bool V1
#&gt; 1:    1  9
#&gt; 2:    0  4</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>.SD</span>[<span class='fl'>2</span>], <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)                    <span class='co'># get 2nd row of each group</span></div><div class='output co'>#&gt;    x v y a b
#&gt; 1: b 1 3 2 8
#&gt; 2: a 2 3 5 5
#&gt; 3: c 2 3 8 2</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span>(<span class='no'>.SD</span>,<span class='fl'>2</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)               <span class='co'># last 2 rows of each group</span></div><div class='output co'>#&gt;    x v y a b
#&gt; 1: b 1 3 2 8
#&gt; 2: b 1 6 3 7
#&gt; 3: a 2 3 5 5
#&gt; 4: a 1 6 6 4
#&gt; 5: c 2 3 8 2
#&gt; 6: c 2 6 9 1</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>sum</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)          <span class='co'># sum of all (other) columns for each group</span></div><div class='output co'>#&gt;    x v  y  a  b
#&gt; 1: b 3 10  6 24
#&gt; 2: a 5 10 15 15
#&gt; 3: c 5 10 24  6</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='no'>.SD</span>[<span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.min</a></span>(<span class='no'>v</span>)], <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)         <span class='co'># nested query by group</span></div><div class='output co'>#&gt;    x v y a b
#&gt; 1: b 1 1 1 9
#&gt; 2: a 1 6 6 4
#&gt; 3: c 1 1 7 3</div><div class='input'>
<span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>MySum</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>),
                <span class='kw'>MyMin</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span>(<span class='no'>v</span>),
                <span class='kw'>MyMax</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span>(<span class='no'>v</span>)),
      <span class='kw'>by</span><span class='kw'>=</span><span class='fu'>.</span>(<span class='no'>x</span>, <span class='no'>y</span><span class='kw'>%%</span><span class='fl'>2</span>)
)                    <span class='co'># by 2 expressions</span></div><div class='output co'>#&gt;    x y MySum MyMin MyMax
#&gt; 1: b 1     2     1     1
#&gt; 2: b 0     1     1     1
#&gt; 3: a 1     4     2     2
#&gt; 4: a 0     1     1     1
#&gt; 5: c 1     3     1     2
#&gt; 6: c 0     2     2     2</div><div class='input'>
<span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'>.</span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fu'>.</span>(<span class='no'>a</span>), <span class='kw'>b</span> <span class='kw'>=</span> <span class='fu'>.</span>(<span class='no'>b</span>)), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)      <span class='co'># list columns</span></div><div class='output co'>#&gt;    x     a     b
#&gt; 1: b 1,2,3 9,8,7
#&gt; 2: a 4,5,6 6,5,4
#&gt; 3: c 7,8,9 3,2,1</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'>.</span>(<span class='kw'>seq</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span>(<span class='no'>a</span>):<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span>(<span class='no'>b</span>)), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)     <span class='co'># j is not limited to just aggregations</span></div><div class='output co'>#&gt;     x seq
#&gt;  1: b   1
#&gt;  2: b   2
#&gt;  3: b   3
#&gt;  4: b   4
#&gt;  5: b   5
#&gt;  6: b   6
#&gt;  7: b   7
#&gt;  8: b   8
#&gt;  9: b   9
#&gt; 10: a   4
#&gt; 11: a   5
#&gt; 12: a   6
#&gt; 13: c   7
#&gt; 14: c   6
#&gt; 15: c   5
#&gt; 16: c   4
#&gt; 17: c   3</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'>query_if</span>(<span class='no'>V1</span><span class='kw'>&lt;</span><span class='fl'>20</span>) <span class='co'># compound query</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: b  3
#&gt; 2: a  5
#&gt; 3: c  5</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>v</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/setorder.html'>setorder</a></span>(-<span class='no'>V1</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>()          <span class='co'># ordering results</span></div><div class='output co'>#&gt;    x V1
#&gt; 1: a  5
#&gt; 2: c  5
#&gt; 3: b  3</div><div class='input'><span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>.N</span>, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>,<span class='no'>sum</span>)), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)     <span class='co'># get number of observations and sum per group</span></div><div class='output co'>#&gt;    x N v  y  a  b
#&gt; 1: b 3 3 10  6 24
#&gt; 2: a 3 5 10 15 15
#&gt; 3: c 3 5 10 24  6</div><div class='input'>
<span class='co'># anonymous lambda in 'j', j accepts any valid</span>
<span class='co'># expression. TO REMEMBER: every element of</span>
<span class='co'># the list becomes a column in result.</span>
<span class='fu'>query</span>(<span class='no'>dat</span>,
      {<span class='no'>tmp</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>y</span>);
      <span class='fu'>.</span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='no'>a</span>-<span class='no'>tmp</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='no'>b</span>-<span class='no'>tmp</span>)
      },
      <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)</div><div class='output co'>#&gt;    x          a          b
#&gt; 1: b -2.3333333  5.6666667
#&gt; 2: b -1.3333333  4.6666667
#&gt; 3: b -0.3333333  3.6666667
#&gt; 4: a  0.6666667  2.6666667
#&gt; 5: a  1.6666667  1.6666667
#&gt; 6: a  2.6666667  0.6666667
#&gt; 7: c  3.6666667 -0.3333333
#&gt; 8: c  4.6666667 -1.3333333
#&gt; 9: c  5.6666667 -2.3333333</div><div class='input'>
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
    <span class='fu'><a href='https://rdrr.io/r/grDevices/pdf.html'>pdf</a></span>(<span class='st'>"new.pdf"</span>)
    <span class='fu'>query</span>(<span class='no'>dat</span>, <span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>a</span>,<span class='no'>b</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>x</span>)                <span class='co'># can also plot in 'j'</span>
    <span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span>()
}
<span class='co'># using rleid, get max(y) and min of all cols in .SDcols for each consecutive run of 'v'</span>
<span class='fu'>query</span>(<span class='no'>dat</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'>.</span>(<span class='kw'>y</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span>(<span class='no'>y</span>)), <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>min</span>)),
      <span class='kw'>by</span><span class='kw'>=</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/rleid.html'>rleid</a></span>(<span class='no'>v</span>),
      <span class='kw'>.SDcols</span><span class='kw'>=</span><span class='no'>v</span>:<span class='no'>b</span>
)</div><div class='output co'>#&gt;    rleid y v y a b
#&gt; 1:     1 6 1 1 1 7
#&gt; 2:     2 3 2 1 4 5
#&gt; 3:     3 6 1 1 6 3
#&gt; 4:     4 6 2 3 8 1</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Tian-Yuan Huang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


